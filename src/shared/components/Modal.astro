---
import {
  Modal as FreeModal,
  ModalBody,
  ModalHeader,
} from "free-astro-components";

import { MODAL_DATA } from "../data/modal_data";
import ContactLink from "./ContactLink.astro";

interface Props {
  id: string;
}
const { id } = Astro.props;
---

<script>
  import type { ContactType } from "../data/modal_data.ts";


  function buildMessage({ toolName }: { toolName: string }) {
    return `Здравствуйте! Хотел бы заказать ${toolName}.`
  }

  function buildLink(type:ContactType, base:string, message:string) {
    const text = encodeURIComponent(message);

    switch (type) {
      case "whatsapp":
        return `${base}?text=${text}`;

      case "telegram":
        return `${base}&text=${text}&profile`;

      case "viber":
        return `${base}&draft=${text}`;

      default:
        return base;
    }
  }
  document.addEventListener("click", (event) => {
    const trigger = event.target!.closest("[data-modal-trigger]");
    if (!trigger) return;

    const data = {
      toolName: trigger.dataset.modalName,
    };

    if (!data.toolName) return;

    const message = buildMessage(data);
    console.log(message);

    document.querySelectorAll("[data-contact-type]").forEach((link) => {
      const type = link.dataset!.contactType;
      const base = link.dataset!.contactBase;

      link.href = buildLink(type, base, message);
    });
  });
</script>


<FreeModal id={id} class="contact_modal">
  <ModalHeader> Наши контакты : </ModalHeader>
  <ModalBody>
    <div class="contact_modal_body">
      {
        MODAL_DATA.CONTACTS.map((contact) => (
          <ContactLink
            href={contact.href}
            icon={contact.icon}
            label={contact.label}
            data-contact-type={contact.type}
            data-contact-base={contact.href}

          />
        ))
      }
    </div>
  </ModalBody>
</FreeModal>

<style>
  :global(.contact_modal) {
    background: rgb(0, 75, 164);
    background: -moz-radial-gradient(
      circle,
      rgba(0, 75, 164, 1) 3%,
      rgba(109, 123, 240, 1) 100%
    );
    background: -webkit-radial-gradient(
      circle,
      rgba(0, 75, 164, 1) 3%,
      rgba(109, 123, 240, 1) 100%
    );
    background: radial-gradient(
      circle,
      rgba(0, 75, 164, 1) 3%,
      rgba(109, 123, 240, 1) 100%
    );
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#004ba4",endColorstr="#6d7bf0",GradientType=1);
    -webkit-box-shadow: 33px -16px 47px -1px rgba(97, 127, 244, 1);
    -moz-box-shadow: 33px -16px 47px -1px rgba(97, 127, 244, 1);
    box-shadow: 33px -16px 47px -1px rgba(97, 127, 244, 1);
    opacity: 0.95;
    border-radius: 4px;

    .ac-modal-close {
      color: #ffffff;
    }
    .ac-modal-header {
      color: #ffffff;
      font-family: "Sansation", sans-serif;
      font-weight: bold;
      font-size: 22px;
      display: flex;
      justify-content: center;
    }

    :global(.ac-modal-close) {
      color: #ffffff;
    }
  }

  .contact_modal_body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 10px;
  }
</style>
